<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WA Legislature Bill Browser</title>
  <script src="alp.js"></script>
  <style>
    html, body { height: 100%; margin: 0; }
  </style>
</head>
<body class="bg-base-200 p-4 h-full flex flex-col overflow-hidden">
  <div x-data="billBrowser()" class="flex-1 flex flex-col min-h-0" x-init="init()">
    <!-- Header with Biennium Buttons -->
    <div class="mb-4">
      <h1 class="text-xl font-bold mb-2">WA Legislature Bill Browser</h1>
      <p class="text-xs text-base-content/70 mb-3">Click a biennium to load bills from the WA Legislature website</p>
      <div class="grid grid-cols-4 sm:grid-cols-6 lg:grid-cols-12 gap-2">
        <template x-for="bi in bienniums" :key="bi">
          <button
            @click="loadBiennium(bi)"
            class="btn btn-xs"
            :class="loaded.has(bi) ? 'btn-primary' : 'btn-outline'"
            x-text="bi"
            :disabled="loading === bi">
          </button>
        </template>
      </div>
    </div>

    <!-- Bill Table Component -->
    <div class="flex-1 min-h-0 border rounded-lg overflow-hidden bg-base-100">
      <alp-bill-table path="bills.browser" class="h-full block"></alp-bill-table>
    </div>

    <!-- Footer -->
    <div class="mt-2 text-xs text-base-content/50" x-text="loading ? 'Loading ' + loading + '...' : ''"></div>
  </div>

  <script>
    function billBrowser() {
      return {
        bienniums: ['2025-26', '2023-24', '2021-22', '2019-20', '2017-18', '2015-16', '2013-14', '2011-12', '2009-10', '2007-08', '2005-06', '2003-04'],
        loaded: new Set(),
        loading: null,
        billTable: null,

        init() {
          this.$nextTick(() => {
            const el = this.$el.querySelector('alp-bill-table');
            // Poll until component data is available
            const check = setInterval(() => {
              if (el.data) {
                this.billTable = el.data;
                this.loaded = this.billTable.loaded;
                clearInterval(check);
              }
            }, 100);
          });
        },

        async loadBiennium(bi) {
          if (!this.billTable || this.loaded.has(bi)) return;

          this.loading = bi;
          try {
            await this.billTable.fetchBiennium(bi);
            this.loaded = new Set(this.billTable.loaded);
          } catch (e) {
            console.error('Failed to load biennium:', bi, e);
            alert('Failed to load ' + bi + ': ' + e.message);
          } finally {
            this.loading = null;
          }
        }
      };
    }
  </script>
</body>
</html>
