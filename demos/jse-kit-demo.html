<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Raw alp.kit.jse Demo</title>
  <script src="https://cdn.jsdelivr.net/gh/mehrlander/Alp@main/alp.js"></script>
  <style>
    html, body { height: 100%; margin: 0; }
    #editor { height: 400px; border: 1px solid #ccc; }
  </style>
</head>
<body class="bg-base-200 p-4 h-full overflow-auto">
  <div class="flex flex-col gap-4 max-w-4xl mx-auto">
    <div class="text-center">
      <h1 class="text-2xl font-bold mb-2">Raw alp.kit.jse Demo</h1>
      <p class="text-sm text-base-content/70">
        Direct use of <code>alp.kit.jse()</code> without the <code>&lt;alp-jse&gt;</code> wrapper component.
        This helps isolate whether issues are in the kit or the wrapper.
      </p>
    </div>

    <div class="flex gap-2 justify-center flex-wrap">
      <button class="btn btn-sm btn-primary" onclick="loadSample()">Load Sample JSON</button>
      <button class="btn btn-sm btn-secondary" onclick="getSample()">Get Current JSON</button>
      <button class="btn btn-sm btn-accent" onclick="switchMode('tree')">Tree Mode</button>
      <button class="btn btn-sm btn-accent" onclick="switchMode('text')">Text Mode</button>
      <button class="btn btn-sm btn-accent" onclick="switchMode('table')">Table Mode</button>
    </div>

    <div class="bg-base-100 rounded-lg shadow-lg overflow-hidden">
      <div id="editor"></div>
    </div>

    <div class="bg-base-100 rounded-lg shadow-lg p-4">
      <h3 class="font-bold mb-2">Output / Status</h3>
      <pre id="output" class="text-xs bg-base-200 p-2 rounded overflow-auto max-h-40"></pre>
    </div>

    <div class="text-center text-xs text-base-content/50 py-4">
      <p>Uses <code>alp.kit.jse({ target, props })</code> directly from vanilla-jsoneditor.</p>
      <p>No alp component wrapper involved - just the raw kit function.</p>
    </div>
  </div>

  <script>
    let editor = null;
    const output = document.getElementById('output');

    const log = (msg) => {
      output.textContent = typeof msg === 'string' ? msg : JSON.stringify(msg, null, 2);
      console.log(msg);
    };

    // Initialize editor when alp is ready
    const initEditor = async () => {
      try {
        log('Initializing editor...');

        editor = await alp.kit.jse({
          target: document.getElementById('editor'),
          props: {
            mode: 'tree',
            content: { json: { message: 'Editor initialized!', timestamp: new Date().toISOString() } },
            onChange: (content) => {
              console.log('Content changed:', content);
            }
          }
        });

        log('Editor initialized successfully!\n\nClick "Load Sample JSON" to load sample data.');
      } catch (e) {
        log('Error initializing editor: ' + e.message);
        console.error(e);
      }
    };

    // Wait for Alpine init (indicates alp is fully loaded)
    document.addEventListener('alpine:init', () => {
      // Small delay to ensure kit is bound
      setTimeout(initEditor, 100);
    });

    // Sample data
    const sampleJson = {
      users: [
        { id: 1, name: 'Alice', email: 'alice@example.com', roles: ['admin', 'user'] },
        { id: 2, name: 'Bob', email: 'bob@example.com', roles: ['user'] },
        { id: 3, name: 'Charlie', email: 'charlie@example.com', roles: ['guest'] }
      ],
      config: {
        theme: 'light',
        debug: false,
        version: '1.0.0',
        features: {
          notifications: true,
          analytics: false,
          darkMode: true
        }
      },
      metadata: {
        created: new Date().toISOString(),
        source: 'demo'
      }
    };

    window.loadSample = async () => {
      if (!editor) {
        log('Editor not initialized yet!');
        return;
      }
      try {
        await editor.set({ json: sampleJson });
        log('Sample JSON loaded!');
      } catch (e) {
        log('Error loading sample: ' + e.message);
      }
    };

    window.getSample = async () => {
      if (!editor) {
        log('Editor not initialized yet!');
        return;
      }
      try {
        const content = editor.get();
        log(content.json || content.text || content);
      } catch (e) {
        log('Error getting content: ' + e.message);
      }
    };

    window.switchMode = async (mode) => {
      if (!editor) {
        log('Editor not initialized yet!');
        return;
      }
      try {
        editor.updateProps({ mode });
        log('Switched to ' + mode + ' mode');
      } catch (e) {
        log('Error switching mode: ' + e.message);
      }
    };
  </script>
</body>
</html>
